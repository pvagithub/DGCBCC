@using WebMVC.Entities;
@model List<DonVi>
@{
    ViewBag.Title = "Thống Kê Thành Phố";
    int i;
    var listNhomTieuChi = (List<ThongKe>)ViewBag.NhomTieuChiTP;
    var listNhomTieuChi2 = (List<ThongKe>)ViewBag.NhomTieuChi;
    var DonViID = 0;
}
<link href="~/Content/grid-0.4.3.min.css" rel="stylesheet" />
<script src="~/Scripts/grid-0.4.3.min.js"></script>
<h3>Thống kê nhóm tiêu chí</h3>

@section scripts{

    <script>
        $('#tuNgay').datepicker({
            dateFormat: "dd/mm/yy", // Notice the Extra space at the beginning
        });
        $('#denNgay').datepicker(
        {
            dateFormat: "dd/mm/yy", // Notice the Extra space at the beginning
        });

        var grid;
        function Search() {
            grid.reload({ searchString: $("#search").val() });
        }

        $(document).ready(function () {
            grid = $("#grid").grid({
                dataKey: "ID",
                uiLibrary: "bootstrap",
                columns: [
                    { field: "ID", width: 50, sortable: true },
                    //{ field: "MaDonVi", title: "Mã Đơn Vị", sortable: true },
                    { field: "TenTieuChi", title: "Tiêu chí", sortable: true },
                    { field: "HaiLong", title: "Hài lòng", sortable: true },
                    { field: "BinhThuong", title: "Bình thường", sortable: true },
                    { field: "KhongHaiLong", title: "Không hài lòng", sortable: true }
                ],
                pager: { enable: true, limit: 15, sizes: [ 5, 10, 15, 20] }
            });
            $("#btnSearch").on("click", Search);
            $("#cbDonVi").on('change', function () {
                var splitted = $(this).val().split("_");

                var link = '@Url.Action("GetReports", new {tuNgay=ViewBag.TuNgay, denNgay=ViewBag.DenNgay,donviID=-1})';
                grid.reload({ searchString: splitted[0] });
            });
        });
    </script>
}
<style>
    /* bootstrap hack:fix content width inside hidden tabs */
    .tab-content > .tab-pane:not(.active),
    .pill-content > .pill-pane:not(.active) {
        display: block;
        height: 0;
        overflow-y: hidden;
    }

    .container-fluid {
        padding-left: 0;
        padding-right: 0;
    }

    .panel {
        box-shadow: none;
    }
    /* bootstrap hack end */
</style>
@using (Html.BeginForm("Index", "ThongKeNhomTieuChi"))
{
    <div class="row">
        <div class="col-md-2">
            <p class="text-right">Ngày bắt đầu:</p>
        </div>
        <div class="col-md-2">
            <input id="tuNgay" name="tuNgay" type="text" value="@ViewBag.TuNgay" placeholder="Chọn ngày bắt đầu" class="form-control">
        </div>
        <div class="col-md-2"><p class="text-right">Ngày kết thúc:</p></div>
        <div class="col-md-2"><input id="denNgay" name="denNgay" type="text" value="@ViewBag.DenNgay" placeholder="Chọn ngày kết thúc" class="form-control"></div>
        <div class="col-md-1"><button type="submit" class="btn btn-primary"><i class="glyphicon glyphicon-search"></i> Xem</button></div>
    </div>
}
<br />
<div class="row">
    <ul id="myTab" class="nav nav-tabs">
        <li class="active"><a href="#tab1" data-toggle="tab">Thành phố</a></li>
        <li class=""><a href="#tab2" data-toggle="tab">Từng đơn vị</a></li>
    </ul>
    <div id="myTabContent" class="tab-content">
        <div class="tab-pane fade active in" id="tab1">
            @if (listNhomTieuChi.Count == 0)
            {
                <div class="warning">Chưa có dữ liệu</div>
            }
            else
            {

                <table class="overflow-y col-lg-12 content_tk  table table-hover   table-bordered">

                    <thead>
                        <tr>

                            <th class="col_cauhoi fix_left">
                                <div class="text_main_col  col_cauhoi fix_left fix_left_1">Tiêu chí</div>
                            </th>
                            @{
                string[] lsttieuChi = listNhomTieuChi[0].KetQuaDanhGia.Split(';');

                for (i = 1; i < lsttieuChi.Length; i++)
                {

                    string[] cauhoi = lsttieuChi[i].Split('☺');

                    <th>
                        <div class="col_cauhoi">

                            <div class="col_tieuchi">
                                @cauhoi[0]
                            </div>
                        </div>
                    </th>

                }

                            }
                        </tr>

                        <tr>

                            <th class="col_cauhoi fix_left">
                                <div class="text_main_col col_cauhoi fix_left fix_left_1">ĐV - Câu TL</div>
                            </th>
                            @{

                for (i = 1; i < lsttieuChi.Length; i++)
                {

                    string[] cauhoi = lsttieuChi[i].Split('☺');

                    <th>

                        @for (int y = 1; y < cauhoi.Length; y++)
                        {
                            string[] cautraloi = cauhoi[y].Split(new[] { "__" }, StringSplitOptions.None);
                            for (int z = 0; z < cautraloi.Length; z++)
                            {
                                var width = 100 / (cautraloi.Length - 1);
                                <div class="item_table item_table_header" style="width:@width%">@cautraloi[z].Split('_')[0]</div>
                            }
                        }
                    </th>
                }}
                        </tr>
                    </thead>
                    <tbody>
                        @for (int e = 0; e < listNhomTieuChi.Count; e++)
                        {

                            <tr>
                                <th class="col_cauhoi fix_left">
                                    <div class="text_main_col">
                                        <a href="#">
                                            @listNhomTieuChi[e].TenDonVi
                                        </a>
                                    </div>
                                </th>
                                @{
                            var item = listNhomTieuChi[e].KetQuaDanhGia;

                            string[] tieuChi1 = item.Split(';');

                            for (i = 1; i < tieuChi1.Length; i++)
                            {

                                string[] cauhoi = tieuChi1[i].Split('☺');

                                <td>

                                    @{
                                string[] cautraloi = cauhoi[1].Split(new[] { "__" }, StringSplitOptions.None);

                                for (int z = 1; z < cautraloi.Length; z++)
                                {
                                    var text = cautraloi[z].ToString();
                                    var index_char = text.Split('_')[0];
                                    var width = 100 / (cautraloi.Length - 1);

                                    <div class="item_table" style="width:@width%">@text.Replace(index_char + "_", "")</div>
                                }
                                    }
                                </td>

                            }
                                }
                            </tr>

                        }
                    </tbody>
                </table>

            }
        </div>
        <div class="tab-pane fade" id="tab2">
            @if (listNhomTieuChi2.Count == 0)
            {
                <div class="warning">Chưa có dữ liệu</div>
            }
            else
            {
                <br />
                <div class="input-group col-md-6 col-xs-12">
                    <span class="form-group input-group-btn">
                        <select class="bs-select form-control" id="cbDonVi">
                            <option value="">--- Chọn đơn vị ---</option>
                            @{
                var lsDVParent = Model.Where(p => p.ParentDonViID == null).ToList();
                foreach (var item in lsDVParent)
                {
                    <optgroup label="@item.TenDonVi">
                        @{
                    var lsDVChild = Model.Where(p => p.ParentDonViID == item.DonViID).ToList();
                    foreach (var it in lsDVChild)
                    {
                        if (ViewBag.madonvi == it.MaDonVi.ToString())
                        {
                            <option value="@it.MaDonVi.ToString()_@it.MaLienThong.ToString()" selected>@it.TenDonVi</option>
                        }
                        else
                        {
                            <option value="@it.MaDonVi.ToString()_@it.MaLienThong.ToString()">@it.TenDonVi</option>
                        }
                    }
                        }
                    </optgroup>
                }
                            }

                        </select>
                    </span>
                </div>
                <br />
    <table id="grid" data-source="@Url.Action("GetReports", new {tuNgay=ViewBag.TuNgay,denNgay=ViewBag.DenNgay })"></table>

                @*<table class="overflow-y col-lg-12 content_tk  table table-hover   table-bordered">

                    <thead>
                        <tr>

                            <th class="col_cauhoi fix_left">
                                <div class="text_main_col  col_cauhoi fix_left fix_left_1">Tiêu chí</div>
                            </th>
                            @{
                string[] lsttieuChi = listNhomTieuChi2[0].KetQuaDanhGia.Split(';');


                for (i = 1; i < lsttieuChi.Length; i++)
                {

                    string[] cauhoi = lsttieuChi[i].Split('☺');

                    <th>
                        <div class="col_cauhoi">

                            <div class="col_tieuchi">
                                @cauhoi[0]
                            </div>
                        </div>
                    </th>

                }

                            }
                        </tr>

                        <tr>

                            <th class="col_cauhoi fix_left">
                                <div class="text_main_col col_cauhoi fix_left fix_left_1">ĐV - Câu TL</div>
                            </th>
                            @{

                for (i = 1; i < lsttieuChi.Length; i++)
                {

                    string[] cauhoi = lsttieuChi[i].Split('☺');

                    <th>

                        @for (int y = 1; y < cauhoi.Length; y++)
                        {
                            string[] cautraloi = cauhoi[y].Split(new[] { "__" }, StringSplitOptions.None);
                            for (int z = 0; z < cautraloi.Length; z++)
                            {
                                var width = 100 / (cautraloi.Length - 1);
                                <div class="item_table item_table_header" style="width:@width%">@cautraloi[z].Split('_')[0]</div>
                            }
                        }
                    </th>
                }}
                        </tr>
                    </thead>
                    <tbody>
                        @for (int e = 0; e < listNhomTieuChi2.Count; e++)
                        {

                            <tr>
                                <th class="col_cauhoi fix_left">
                                    <div class="text_main_col">
                                        <a href="#">
                                            @listNhomTieuChi2[e].TenDonVi
                                        </a>
                                    </div>
                                </th>
                                @{
                            var item = listNhomTieuChi2[e].KetQuaDanhGia;

                            string[] tieuChi1 = item.Split(';');

                            for (i = 1; i < tieuChi1.Length; i++)
                            {

                                string[] cauhoi = tieuChi1[i].Split('☺');

                                <td>

                                    @{
                                string[] cautraloi = cauhoi[1].Split(new[] { "__" }, StringSplitOptions.None);

                                for (int z = 1; z < cautraloi.Length; z++)
                                {
                                    var text = cautraloi[z].ToString();
                                    var index_char = text.Split('_')[0];
                                    var width = 100 / (cautraloi.Length - 1);

                                    <div class="item_table" style="width:@width%">@text.Replace(index_char + "_", "")</div>
                                }
                                    }
                                </td>

                            }
                                }
                            </tr>

                        }
                    </tbody>
                </table>*@

            }
        </div>
    </div>
</div>
